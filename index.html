<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Read Later on reMarkable</title>

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="reMarkable PDF">
    <link rel="apple-touch-icon" href="./icon-192.png">

    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Covered+By+Your+Grace&family=Outfit:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- PDF Generation Libraries -->
    <script src="https://github.com/foliojs/pdfkit/releases/download/v0.14.0/pdfkit.standalone.js"></script>
    <script src="https://github.com/devongovett/blob-stream/releases/download/v0.1.3/blob-stream.js"></script>

    <!-- PDF.js for reading PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js"></script>

    <!-- Readability.js for fast text extraction -->
    <script src="https://cdn.jsdelivr.net/npm/@mozilla/readability@0.5.0/Readability.min.js"></script>

    <!-- DOMPurify for safe HTML injection -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <div class="background-mesh"></div>

    <main id="app-container" class="glass-panel">
        <header class="app-header">
            <h1 class="target-title font-handwriting">Read Later on reMarkable <span
                    style="font-size: 0.4em; vertical-align: middle; color: #4f46e5;">v5.0</span></h1>
            <p class="subtitle">Create beautiful PDFs optimized for <span class="badge">Paper Pro</span> & <span
                    class="badge">Pro Move</span>.</p>
        </header>

        <div class="input-group url-action-section">
            <label for="url-input">
                <span class="material-symbols-outlined">link</span>
                Article URL
            </label>
            <div class="input-wrapper">
                <input type="url" id="url-input" placeholder="https://www.example.com/article..." autocomplete="off">
                <button id="paste-btn" class="btn-paste" aria-label="Paste URL">
                    <span class="material-symbols-outlined">content_paste</span>
                    Paste
                </button>
            </div>

            <div class="action-buttons-grid"
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                <button id="btn-quick-pdf" class="btn-primary" style="padding: 1rem; width: 100%;">
                    <span class="icon-wrapper" style="margin-bottom: 5px;">
                        <span class="material-symbols-outlined">picture_as_pdf</span>
                    </span>
                    Option 1:<br>Quick PDF
                </button>

                <button id="btn-read-native" class="btn-secondary"
                    style="padding: 1rem; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px;">
                    <span class="icon-wrapper" style="background: rgba(14, 165, 233, 0.1); color: var(--clr-accent);">
                        <span class="material-symbols-outlined">menu_book</span>
                    </span>
                    Option 2:<br>Read Natively
                </button>
            </div>
        </div>

        <div class="divider">
            <span>OR</span>
        </div>

        <details class="input-group details-group" id="pdf-upload-group">
            <summary class="details-summary">
                <span class="material-symbols-outlined">folder_open</span>
                Option 2: Upload PDF
            </summary>
            <div class="details-content">
                <label for="pdf-upload" class="file-label">
                    <div class="file-upload-content">
                        <span class="material-symbols-outlined icon-large">upload_file</span>
                        <span class="file-title">Select a PDF file</span>
                        <span class="file-subtitle">Click to browse or drag & drop</span>
                    </div>
                </label>
                <input type="file" id="pdf-upload" accept="application/pdf" class="sr-only">
                <div id="file-name-display" class="file-name-display hidden" style="margin-bottom: 10px;"></div>
                <button id="btn-process-pdf" class="btn-primary" style="width: 100%;">
                    <span class="icon-wrapper">
                        <span class="material-symbols-outlined">auto_awesome</span>
                    </span>
                    Re-format PDF
                </button>
            </div>
        </details>

        <div class="divider">
            <span>SETTINGS</span>
        </div>

        <details class="input-group details-group" id="api-key-group">
            <summary class="details-summary">
                <span class="material-symbols-outlined">key</span>
                Gemini API Key
                <span class="summary-hint">(Stored securely in your browser)</span>
            </summary>
            <div class="details-content input-wrapper">
                <input type="password" id="api-key-input" placeholder="AIzaSy...">
                <button id="toggle-key-btn" class="btn-icon" aria-label="Toggle API Key Visibility">
                    <span class="material-symbols-outlined" id="toggle-key-icon">visibility</span>
                </button>
            </div>
        </details>

        <div class="action-area" style="margin-top: 1rem;">
            <div class="toggle-container"
                style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                <label for="extraction-toggle"
                    style="font-family: 'Outfit', sans-serif; font-size: 0.9rem; color: #475569;">Extraction
                    Engine:</label>
                <div class="toggle-switch">
                    <input type="checkbox" id="extraction-toggle" class="sr-only">
                    <label for="extraction-toggle" class="toggle-label">
                        <span class="toggle-text ai-text">Detailed (AI)</span>
                        <span class="toggle-slider"></span>
                        <span class="toggle-text fast-text">Fast (Local)</span>
                    </label>
                </div>
            </div>
        </div>

        <div id="status" class="status-message"></div>

        <div id="history-section" class="history-section hidden">
            <div class="history-header">
                <h2>History</h2>
                <button id="clear-history-btn" class="btn-text" aria-label="Clear History">
                    <span class="material-symbols-outlined">delete_sweep</span>
                </button>
            </div>
            <div id="history-list" class="history-list">
                <!-- History items injected here -->
            </div>
        </div>

    </main>

    <!-- Native Reading Mode Container (Hidden by default) -->
    <main class="reading-mode-container hidden" id="reading-view">
        <header class="reading-header glass-effect">
            <button id="btn-close-reading" class="btn-icon" aria-label="Go Back">
                <span class="material-symbols-outlined">arrow_back</span>
            </button>
            <div class="reading-title-banner">
                <span class="material-symbols-outlined"
                    style="font-size: 1.2rem; color: var(--clr-primary);">menu_book</span>
                <span>Reading Mode</span>
            </div>
            <button id="btn-reading-pdf" class="btn-primary btn-small">
                <span class="material-symbols-outlined" style="font-size: 1.2rem;">picture_as_pdf</span>
                <span class="hide-mobile">Save to reMarkable</span>
            </button>
        </header>

        <div class="newspaper-layout" id="newspaper-content">
            <!-- Article Content Injected Here -->
        </div>
    </main>

    <!-- Application Logic -->
    <script src="./script.js"></script>
</body>

</html>